<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NZGDC Dynamic Category Filtering Test Demo</title>
    <!-- Load CSS files in proper order -->
    <link rel="stylesheet" href="../css/unified-event-panel.css">
    <link rel="stylesheet" href="../css/morning-schedule-bundle.css">
    <link rel="stylesheet" href="../css/afternoon-schedule-bundle.css">
    <link rel="stylesheet" href="../css/thursday-schedule-bundle.css">
    <link rel="stylesheet" href="../css/category-filter-overlay.css">
    <style>
        /* Dynamic Category Filtering Test Demo - Unique Visual Design */
        :root {
            --color-test-primary: rgba(34, 139, 34, 1); /* Forest Green */
            --color-test-secondary: rgba(50, 205, 50, 1); /* Lime Green */
            --color-test-accent: rgba(173, 255, 47, 1); /* Green Yellow */
            --color-test-dark: rgba(0, 100, 0, 1); /* Dark Green */
            --color-test-light: rgba(240, 255, 240, 1); /* Honeydew */
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --font-primary: 'Futura PT Heavy', 'Futura', Arial, sans-serif;
            --font-secondary: 'Arial', sans-serif;
        }

        body {
            font-family: var(--font-primary);
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--color-test-light) 0%, #f0fff0 50%, var(--color-test-light) 100%);
            min-height: 100vh;
        }

        .demo-header {
            background: linear-gradient(45deg, var(--color-test-primary), var(--color-test-dark));
            color: var(--color-white);
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(34, 139, 34, 0.3);
            position: relative;
            overflow: hidden;
        }

        .demo-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="25" cy="25" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="3" fill="rgba(255,255,255,0.08)"/><circle cx="50" cy="10" r="1.5" fill="rgba(255,255,255,0.12)"/></svg>') repeat;
            pointer-events: none;
        }

        .demo-header h1 {
            margin: 0;
            font-size: 36px;
            font-weight: 900;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .demo-header p {
            margin: 10px 0 0 0;
            font-size: 18px;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        .demo-section {
            margin: 25px;
            background: var(--color-white);
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(34, 139, 34, 0.15);
            overflow: hidden;
            position: relative;
        }

        .demo-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--color-test-secondary), var(--color-test-accent), var(--color-test-secondary));
        }

        .demo-section h2 {
            background: linear-gradient(90deg, var(--color-test-secondary), var(--color-test-accent));
            color: var(--color-black);
            margin: 0;
            padding: 20px 25px;
            font-size: 28px;
            font-weight: 900;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
            border-bottom: 2px solid var(--color-test-dark);
        }

        .widget-container {
            padding: 0;
            background: #fefefe;
        }

        .test-instructions {
            padding: 30px;
            background: linear-gradient(135deg, #f0fff0 0%, #f5fffa 100%);
            border-left: 6px solid var(--color-test-secondary);
            border-right: 6px solid var(--color-test-accent);
            margin: 25px;
            position: relative;
            box-shadow: inset 0 0 10px rgba(34, 139, 34, 0.1);
        }

        .test-instructions::before {
            content: '🎯';
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
        }

        .test-instructions h3 {
            margin-top: 0;
            color: var(--color-test-primary);
            font-size: 24px;
            font-weight: 800;
            border-bottom: 2px solid var(--color-test-accent);
            padding-bottom: 10px;
        }

        .test-instructions h4 {
            color: var(--color-test-dark);
            font-size: 18px;
            font-weight: 700;
            margin: 20px 0 10px 0;
        }

        .test-instructions ul, .test-instructions ol {
            margin: 15px 0;
            padding-left: 25px;
        }

        .test-instructions li {
            margin: 8px 0;
            line-height: 1.6;
            color: #333;
        }

        .test-instructions li strong {
            color: var(--color-test-primary);
        }

        .category-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 30px;
        }

        .category-list {
            background: var(--color-white);
            border: 2px solid var(--color-test-secondary);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(34, 139, 34, 0.1);
        }

        .category-list h4 {
            margin-top: 0;
            color: var(--color-test-primary);
            font-size: 18px;
            font-weight: 700;
            border-bottom: 1px solid var(--color-test-accent);
            padding-bottom: 8px;
        }

        .category-list ul {
            margin: 15px 0 0 0;
            padding-left: 20px;
        }

        .category-list li {
            margin: 6px 0;
            color: #444;
            font-size: 14px;
        }

        .debug-info {
            margin: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: #ecf0f1;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border: 2px solid var(--color-test-dark);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .debug-toggle {
            margin: 25px;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--color-test-light), #fff);
            border: 2px solid var(--color-test-accent);
        }

        .debug-toggle button {
            padding: 12px 24px;
            background: linear-gradient(45deg, var(--color-test-secondary), var(--color-test-accent));
            color: var(--color-black);
            border: 2px solid var(--color-test-dark);
            cursor: pointer;
            font-family: var(--font-primary);
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(34, 139, 34, 0.2);
        }

        .debug-toggle button:hover {
            background: linear-gradient(45deg, var(--color-test-accent), var(--color-test-secondary));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(34, 139, 34, 0.3);
        }

        /* Ensure widgets display properly */
        .nzgdc-schedule-widget,
        .nzgdc-morning-schedule-widget,
        .nzgdc-afternoon-schedule-widget {
            width: 100%;
            max-width: none;
        }

        /* Visual click indicators */
        .click-indicator {
            position: absolute;
            pointer-events: none;
            background: radial-gradient(circle, var(--color-test-accent) 0%, transparent 70%);
            border-radius: 50%;
            transform: scale(0);
            animation: clickPulse 0.6s ease-out;
            z-index: 1000;
        }

        @keyframes clickPulse {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* Responsive design */
        @media (max-width: 1200px) {
            .category-comparison {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            .demo-header h1 {
                font-size: 28px;
            }

            .demo-header p {
                font-size: 16px;
            }

            .demo-section h2 {
                font-size: 22px;
                padding: 15px 20px;
            }

            .test-instructions {
                padding: 20px;
                margin: 15px;
            }
        }
    </style>
    <script>
        // Enable debug mode
        window.NZGDC_DEBUG = true;

        // Visual click feedback
        function createClickIndicator(x, y) {
            const indicator = document.createElement('div');
            indicator.className = 'click-indicator';
            indicator.style.left = (x - 25) + 'px';
            indicator.style.top = (y - 25) + 'px';
            indicator.style.width = '50px';
            indicator.style.height = '50px';
            document.body.appendChild(indicator);

            setTimeout(() => {
                document.body.removeChild(indicator);
            }, 600);
        }

        document.addEventListener('click', function(e) {
            // Only show indicators for dropdown and filter interactions
            if (e.target.closest('.category-dropdown-item') ||
                e.target.closest('.nzgdc-morning-filters-value') ||
                e.target.closest('.nzgdc-afternoon-filters-value') ||
                e.target.closest('.nzgdc-filters-value')) {
                createClickIndicator(e.pageX, e.pageY);
            }
        });

        // Toggle debug info visibility
        function toggleDebug() {
            const debugInfo = document.getElementById('debug-info');
            const debugToggle = document.getElementById('debug-toggle-btn');

            if (debugInfo.style.display === 'none') {
                debugInfo.style.display = 'block';
                debugToggle.textContent = 'Hide Debug Info';
            } else {
                debugInfo.style.display = 'none';
                debugToggle.textContent = 'Show Debug Info';
            }
        }

        // Extract available categories from event data
        function analyzeEventData() {
            const schedules = {
                morning: window.MORNING_EVENTS || {},
                afternoon: window.AFTERNOON_EVENTS || {},
                thursday: window.WORKSHOP_EVENTS || {}
            };

            const analysis = {};

            Object.keys(schedules).forEach(schedule => {
                const events = schedules[schedule];
                const categories = new Set();

                Object.values(events).forEach(event => {
                    if (event.categoryKey) {
                        categories.add(event.categoryKey);
                    }
                });

                analysis[schedule] = Array.from(categories);
            });

            return analysis;
        }

        // Display category analysis
        function displayCategoryAnalysis() {
            const analysis = analyzeEventData();

            // Update comparison lists
            const morningList = document.getElementById('morning-categories');
            const afternoonList = document.getElementById('afternoon-categories');
            const thursdayList = document.getElementById('thursday-categories');

            if (morningList) {
                morningList.innerHTML = analysis.morning.map(cat => `<li>${getCategoryDisplayName(cat)}</li>`).join('');
            }

            if (afternoonList) {
                afternoonList.innerHTML = analysis.afternoon.map(cat => `<li>${getCategoryDisplayName(cat)}</li>`).join('');
            }

            if (thursdayList) {
                thursdayList.innerHTML = analysis.thursday.map(cat => `<li>${getCategoryDisplayName(cat)}</li>`).join('');
            }

            console.log('Category Analysis:', analysis);
        }

        function getCategoryDisplayName(categoryKey) {
            const displayNames = {
                'GAME_DESIGN': 'Game Design',
                'ART': 'Art',
                'PROGRAMMING': 'Programming',
                'AUDIO': 'Audio',
                'STORY_NARRATIVE': 'Story & Narrative',
                'BUSINESS_MARKETING': 'Business & Marketing',
                'CULTURE': 'Culture',
                'PRODUCTION_QA': 'Production & QA',
                'REALITIES_VR_AR_MR': 'Realities (VR, AR, MR)',
                'DATA_TESTING_RESEARCH': 'Data, Testing or Research',
                'SERIOUS_EDUCATIONAL': 'Serious & Educational Games'
            };

            return displayNames[categoryKey] || categoryKey;
        }

        // Initialize after DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                displayCategoryAnalysis();
            }, 1000);
        });
    </script>
</head>
<body>
    <header class="demo-header">
        <h1>🎯 Dynamic Category Filtering Test Demo</h1>
        <p>Testing environment for dynamic category filtering - dropdown menus show only categories available in each schedule's data</p>
    </header>

    <div class="test-instructions">
        <h3>🧪 Dynamic Category Filtering Test Protocol</h3>
        <p><strong>This specialized testing environment validates the NEW Dynamic Category Filtering feature - each schedule's dropdown only shows categories that actually exist in its event data, rather than showing all 11 categories regardless.</strong></p>

        <h4>🚀 NEW FEATURE: Data-Driven Category Dropdowns</h4>
        <ul>
            <li><strong>📊 Smart Detection:</strong> Each widget analyzes its event data to find which categories are actually present</li>
            <li><strong>🎯 Focused Dropdowns:</strong> Dropdown menus only show relevant categories for each schedule</li>
            <li><strong>🔍 Eliminates Empty Categories:</strong> No more selecting categories that have zero events in that schedule</li>
            <li><strong>⚡ Improved UX:</strong> Shorter dropdown lists with only meaningful options</li>
            <li><strong>🛡️ Fallback Protection:</strong> If no categories are detected, shows all categories as safety measure</li>
        </ul>

        <h4>🔬 Testing Steps:</h4>
        <ol>
            <li><strong>Examine Category Lists:</strong> Check the comparison below to see which categories are in each schedule</li>
            <li><strong>Test Morning Widget:</strong> Open morning dropdown - should only show categories present in morning data</li>
            <li><strong>Test Afternoon Widget:</strong> Open afternoon dropdown - should only show categories present in afternoon data</li>
            <li><strong>Test Thursday Widget:</strong> Open Thursday dropdown - should only show categories present in workshop data</li>
            <li><strong>Compare Dropdowns:</strong> Notice how each dropdown contains different category lists</li>
            <li><strong>Verify Filtering:</strong> Select categories to ensure filtering still works correctly</li>
        </ol>

        <h4>🔍 Key Features to Validate:</h4>
        <ul>
            <li><strong>Dynamic Detection:</strong> Categories are detected from actual event data, not hardcoded lists</li>
            <li><strong>Schedule-Specific Lists:</strong> Each widget shows only its relevant categories</li>
            <li><strong>Alphabetical Sorting:</strong> Categories are sorted alphabetically (with "All Events" always first)</li>
            <li><strong>Functional Filtering:</strong> Selected categories still filter events correctly</li>
            <li><strong>Debug Information:</strong> Console logging shows category detection process</li>
            <li><strong>Fallback Safety:</strong> System gracefully handles missing or empty data</li>
        </ul>
    </div>

    <div class="category-comparison">
        <div class="category-list">
            <h4>🌅 Morning Schedule Categories</h4>
            <ul id="morning-categories">
                <li>Loading...</li>
            </ul>
        </div>
        <div class="category-list">
            <h4>🌆 Afternoon Schedule Categories</h4>
            <ul id="afternoon-categories">
                <li>Loading...</li>
            </ul>
        </div>
        <div class="category-list">
            <h4>📚 Thursday Workshop Categories</h4>
            <ul id="thursday-categories">
                <li>Loading...</li>
            </ul>
        </div>
    </div>

    <div class="demo-section">
        <h2>🌅 Morning Schedule Widget - Dynamic Categories</h2>
        <div class="widget-container">
            <div id="morning-widget-container"></div>
        </div>
    </div>

    <div class="demo-section">
        <h2>🌆 Afternoon Schedule Widget - Dynamic Categories</h2>
        <div class="widget-container">
            <div id="afternoon-widget-container"></div>
        </div>
    </div>

    <div class="demo-section">
        <h2>📚 Thursday Schedule Widget - Dynamic Categories</h2>
        <div class="widget-container">
            <div id="thursday-widget-container"></div>
        </div>
    </div>

    <div class="debug-toggle">
        <h3>🔧 Development Tools</h3>
        <p>Use the debug console to monitor category detection and filtering processes</p>
        <button id="debug-toggle-btn" onclick="toggleDebug()">Hide Debug Info</button>
        <button onclick="displayCategoryAnalysis()">Refresh Category Analysis</button>
        <button onclick="console.clear()">Clear Console</button>
    </div>

    <div class="debug-info" id="debug-info">
        <h4>🔍 Debug Information</h4>
        <p><strong>Console Monitoring:</strong> Open browser developer console (F12) to see detailed category detection logging</p>
        <p><strong>Expected Behavior:</strong></p>
        <ul>
            <li>Morning widget should detect categories from MORNING_EVENTS data</li>
            <li>Afternoon widget should detect categories from AFTERNOON_EVENTS data</li>
            <li>Thursday widget should detect categories from WORKSHOP_EVENTS data</li>
            <li>Each dropdown should show only relevant categories</li>
            <li>Filtering should work correctly with detected categories</li>
        </ul>
        <p><strong>Debug Commands:</strong></p>
        <ul>
            <li><code>analyzeEventData()</code> - Shows category analysis for all schedules</li>
            <li><code>window.MORNING_EVENTS</code> - Inspect morning event data</li>
            <li><code>window.AFTERNOON_EVENTS</code> - Inspect afternoon event data</li>
            <li><code>window.WORKSHOP_EVENTS</code> - Inspect workshop event data</li>
        </ul>
    </div>

    <!-- Load event data files -->
    <script src="../js/morning-events.js"></script>
    <script src="../js/afternoon-events.js"></script>
    <script src="../js/workshop-events.js"></script>

    <!-- Load schedule data files -->
    <script src="../js/morning-schedule-data.js"></script>
    <script src="../js/afternoon-schedule-data.js"></script>
    <script src="../js/schedule-data.js"></script>

    <!-- Load widget system files -->
    <script src="../js/unified-event-loader.js"></script>
    <script src="../js/morning-schedule-generator.js"></script>
    <script src="../js/afternoon-schedule-generator.js"></script>
    <script src="../js/schedule-generator.js"></script>
    <script src="../js/morning-widget-core.js"></script>
    <script src="../js/afternoon-widget-core.js"></script>
    <script src="../js/widget-core.js"></script>

    <script>
        // Initialize widgets after all scripts are loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎯 Dynamic Category Filtering Test Demo Initializing...');

            // Create widgets with unique IDs and containers
            setTimeout(() => {
                try {
                    // Initialize Morning Widget
                    console.log('Initializing Morning Widget...');
                    const morningWidget = new NZGDCMorningScheduleWidget('morning-widget-container', {
                        debugMode: true,
                        height: '600px'
                    });

                    // Initialize Afternoon Widget
                    console.log('Initializing Afternoon Widget...');
                    const afternoonWidget = new NZGDCAfternoonScheduleWidget('afternoon-widget-container', {
                        debugMode: true,
                        height: '600px'
                    });

                    // Initialize Thursday Widget
                    console.log('Initializing Thursday Widget...');
                    const thursdayWidget = new NZGDCScheduleWidget('thursday-widget-container', {
                        debugMode: true,
                        height: '600px'
                    });

                    console.log('✅ All widgets initialized successfully');

                    // Refresh category analysis after widgets are loaded
                    setTimeout(() => {
                        displayCategoryAnalysis();
                        console.log('✅ Category analysis refreshed');
                    }, 2000);

                } catch (error) {
                    console.error('❌ Error initializing widgets:', error);
                }
            }, 500);
        });
    </script>
</body>
</html>
