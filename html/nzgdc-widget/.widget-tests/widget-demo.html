<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NZGDC Schedule Widgets Demo</title>
    <!-- Load unified event panel styles FIRST - contains all centralized event panel component styles -->
    <link rel="stylesheet" href="../css/unified-event-panel.css">
    <!-- Load widget-specific bundles AFTER unified - these only contain layout/positioning, not component styles -->
    <link rel="stylesheet" href="../css/thursday-schedule-bundle.css">
    <link rel="stylesheet" href="../css/friday-saturday-schedule-bundle.css">
    <!-- Load core dependencies first - ORDER MATTERS! -->
    <script src="../js/schedule-data.js"></script>
    <script src="../js/workshop-events.js"></script>
    <script src="../js/morning-schedule-data.js"></script>
    <script src="../js/morning-events.js"></script>
    <script src="../js/afternoon-schedule-data.js"></script>
    <script src="../js/afternoon-events.js"></script>

    <!-- Load utility and generator modules -->
    <script src="../js/unified-event-loader.js"></script>
    <script src="../js/schedule-generator.js"></script>
    <script src="../js/morning-schedule-generator.js"></script>
    <script src="../js/afternoon-schedule-generator.js"></script>
    <script src="../js/expanded-event-details-manager.js"></script>

    <!-- Load API modules -->
    <script src="../js/data-transformer.js"></script>
    <script src="../js/data-manager.js"></script>
    <script src="../js/event-api.js"></script>
    <script src="../js/schedule-api.js"></script>
    <script src="../js/speaker-api.js"></script>
    <script src="../js/category-api.js"></script>
    <script src="../js/room-api.js"></script>
    <script src="../js/stream-api.js"></script>
    <script src="../js/session-type-api.js"></script>

    <!-- Load widget core modules -->
    <script src="../js/widget-core.js"></script>
    <script src="../js/friday-saturday-widget-core.js"></script>

    <!-- Load modular widget entry points -->
    <script src="../nzgdc-schedule-widget-modular.js"></script>
    <script src="../nzgdc-friday-saturday-schedule-widget-modular.js"></script>


    <style>
        /* NZGDC Color Variables */
        :root {
            --color-yellow: rgba(255, 236, 81, 1);
            --color-blue: rgba(23, 75, 235, 1);
            --color-blue-hover: rgba(20, 65, 200, 1);
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-yellow-bright: rgba(240, 223, 86, 1);
            --font-primary: 'Futura PT Heavy', 'Futura', Arial, sans-serif;
        }

        body {
            font-family: var(--font-primary);
            margin: 0;
            padding: 0;
            background-color: var(--color-white);
        }

        .demo-header {
            background: var(--color-blue);
            color: var(--color-white);
            padding: 20px;
            text-align: center;
        }

        .demo-header h1 {
            margin: 0;
            font-size: 36px;
            font-weight: 800;
            font-family: var(--font-primary);
        }

        .demo-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .demo-controls button {
            background: var(--color-yellow-bright);
            color: var(--color-black);
            border: none;
            padding: 10px 20px;
            border-radius: 0;
            cursor: pointer;
            font-size: 16px;
            font-family: var(--font-primary);
            font-weight: 600;
            text-transform: uppercase;
            transition: background-color 0.3s ease;
            margin: 0 5px;
        }

        .demo-controls button:hover {
            background: var(--color-yellow);
        }

        .demo-controls button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .status {
            text-align: center;
            padding: 10px;
            margin: 20px 0;
            background: #f0f0f0;
            border-left: 4px solid #ccc;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            border-left-color: #28a745;
        }

        .status.error {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .demo-content {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .no-widgets-message {
            text-align: center;
            padding: 40px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .no-widgets-message h3 {
            margin: 0 0 20px 0;
            color: var(--color-blue);
            font-size: 24px;
            font-weight: 800;
        }

        .no-widgets-message p {
            color: #666;
            margin: 0 0 15px 0;
        }

        .no-widgets-message ul {
            text-align: left;
            max-width: 500px;
            margin: 20px auto;
        }

        .no-widgets-message li {
            margin-bottom: 8px;
        }

        .no-widgets-message .instructions {
            background: white;
            padding: 20px;
            border-radius: 4px;
        }

        .no-widgets-message .demo-controls {
            margin-top: 20px;
        }

        .no-widgets-message .demo-controls button {
            margin: 5px;
        }

        .demo-footer {
            background: #333;
            color: white;
            padding: 15px 20px;
            text-align: center;
            position: fixed;
            bottom: 0;
            width: 100%;
            box-sizing: border-box;
        }

        .demo-footer button {
            background: transparent;
            color: white;
            border: 1px solid white;
            padding: 5px 15px;
            cursor: pointer;
            margin-left: 10px;
        }

        .demo-footer button:hover {
            background: white;
            color: #333;
        }

        .widget-section {
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .demo-controls {
                flex-direction: column;
                align-items: center;
            }

            .demo-controls button {
                width: 80%;
                max-width: 300px;
            }

            .no-widgets-message {
                margin: 10px;
            }

            .no-widgets-message h3 {
                font-size: 20px;
            }

            .no-widgets-message p {
                font-size: 14px;
            }
        }

        /* Widget sections initially hidden */
        #thursday-container,
        #friday-saturday-container {
            display: none;
            width: 100%;
            max-width: none;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Widget section headers */
        .widget-section h2 {
            color: var(--color-blue);
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 20px;
            text-align: center;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>
<body>
    <header class="demo-header">
        <h1>NZGDC Schedule Widgets Demo</h1>
        <div class="demo-controls">
            <button onclick="toggleWidget()" id="toggle-btn">Load Thursday Schedule</button>
            <button onclick="testWidget()" id="test-btn" disabled>Test Widget</button>
            <button onclick="clearWidget()" id="clear-btn" disabled>Clear Widget</button>
            <button onclick="destroyWidget()" id="destroy-btn" disabled>Destroy Widget</button>
            <button onclick="verifyData()" id="verify-btn">Verify Data</button>
            <button onclick="toggleDebug()" id="debug-btn">Enable Debug</button>
            <button onclick="debugFridaySaturdayDataFlow()" id="flow-debug-btn">Debug F/S Data Flow</button>
        </div>
    </header>

    <div id="status" class="status">Ready to load widgets</div>

    <div class="demo-content">
        <!-- Background message when no widgets are loaded -->
        <div class="no-widgets-message" id="background-message">
            <h3>Welcome to NZGDC Schedule Widgets Demo</h3>
            <p>This demo showcases the unified NZGDC event schedule widget system with seamless switching between different schedule views.</p>

            <ul>
                <li><strong>Thursday Schedule:</strong> Workshop schedule with 10 events across morning and afternoon time slots</li>
                <li><strong>Friday/Saturday Schedule:</strong> Unified event schedule with Morning Events and Afternoon Events tabs</li>
            </ul>

            <div class="instructions">
                <p><strong>How to use:</strong></p>
                <ul>
                    <li>Use the <strong>toggle button</strong> above to switch between Thursday and Friday/Saturday schedules</li>
                    <li>In Friday/Saturday view, use the <strong>Morning Events</strong> and <strong>Afternoon Events</strong> buttons to switch views</li>
                    <li>Only one schedule is visible at a time</li>
                    <li>Use the other controls to test, clear, or destroy the current schedule widget</li>
                </ul>

                <p><strong>Note:</strong> Friday/Saturday schedule now includes seamless view switching using existing navigation buttons.</p>
            </div>
        </div>

    </div>

    <!-- Thursday Schedule Widget -->
    <div class="widget-section thursday-section" id="thursday-container">
        <h2>Thursday Workshop Schedule</h2>
        <!-- Widget content will be inserted here -->
    </div>

    <!-- Friday/Saturday Schedule Widget -->
    <div class="widget-section friday-saturday-section" id="friday-saturday-container">
        <h2>Friday & Saturday Schedule</h2>
        <!-- Unified widget content will be inserted here -->
    </div>

    <footer class="demo-footer">
        <span>Widgets Status: <span id="widget-status">Not loaded</span></span>
        <button onclick="showInfo()">Show Info</button>
        <button onclick="showConsole()">Console</button>
        <button onclick="location.reload()">Refresh</button>
    </footer>

    <script>
        let widgetLoaded = false;
        let fridaySaturdayWidgetLoaded = false;
        let currentWidget = null;
        let currentFridaySaturdayWidget = null;
        let debugEnabled = false; // Debug disabled by default

        // Set global debug flag for widgets
        window.NZGDC_DEBUG = false;

        // Globally accessible DataManager instance
        window.dataManagerInstance = null;

        // Initialize DataManager when DOM and scripts are ready
        async function initializeDataManager() {
            // Wait a bit to ensure all scripts are loaded
            await new Promise(resolve => setTimeout(resolve, 100));

            if (typeof DataManager !== 'undefined') {
                dataManagerInstance = new DataManager({
                    dataSource: 'local',
                    localDataPath: './n8n-entegyapi.json'
                });
                try {
                    await dataManagerInstance.initialize();
                    if (debugEnabled) {
                        console.log('DataManager initialized successfully with local data.');

                        // Debug: Check if we have schedule data
                        const schedules = dataManagerInstance.getScheduleData();
                        console.log(`DataManager loaded ${schedules.length} schedules:`,
                            schedules.map(s => `${s.title} (${s.date})`));

                        // Check for Friday/Saturday schedules specifically
                        const fridaySat = schedules.filter(s => {
                            const date = new Date(s.date);
                            const day = date.getDay();
                            return day === 5 || day === 6;
                        });
                        console.log(`Found ${fridaySat.length} Friday/Saturday schedules with sessions:`,
                            fridaySat.map(s => `${s.title}: ${s.sessions?.length || 0} sessions`));
                    }

                } catch (error) {
                    console.error('Failed to initialize DataManager:', error);
                }
            } else {
                console.error('DataManager is not defined. Ensure data-manager.js is loaded correctly.');
                // Retry after a delay
                setTimeout(initializeDataManager, 500);
            }
        }

        let currentWidgetType = null;

        function checkScriptLoadingStatus() {
            if (debugEnabled) {
                console.log('=== Script Loading Status ===');
                console.log('SCHEDULE_DATA:', typeof window.SCHEDULE_DATA);
                console.log('WORKSHOP_EVENTS:', typeof window.WORKSHOP_EVENTS);
                console.log('MORNING_SCHEDULE_DATA:', typeof window.MORNING_SCHEDULE_DATA);
                console.log('MORNING_EVENTS:', typeof window.MORNING_EVENTS);
                console.log('AFTERNOON_SCHEDULE_DATA:', typeof window.AFTERNOON_SCHEDULE_DATA);
                console.log('AFTERNOON_EVENTS:', typeof window.AFTERNOON_EVENTS);
                console.log('NZGDCWidget:', typeof window.NZGDCWidget);
                console.log('NZGDCMorningWidget:', typeof window.NZGDCMorningWidget);
                console.log('NZGDCAfternoonWidget:', typeof window.NZGDCAfternoonWidget);
                console.log('UnifiedEventLoader:', typeof window.UnifiedEventLoader);
                console.log('DataManager:', typeof window.DataManager);
                console.log('ExpandedEventDetailsManager:', typeof window.ExpandedEventDetailsManager);
                console.log('DataTransformer:', typeof window.DataTransformer);
                console.log('EventAPI:', typeof window.EventAPI);
                console.log('ScheduleAPI:', typeof window.ScheduleAPI);
                console.log('SpeakerAPI:', typeof window.SpeakerAPI);
                console.log('CategoryAPI:', typeof window.CategoryAPI);
                console.log('RoomAPI:', typeof window.RoomAPI);
                console.log('StreamAPI:', typeof window.StreamAPI);
                console.log('SessionTypeAPI:', typeof window.SessionTypeAPI);
            }
        }

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function updateButtonStates() {
            const toggleBtn = document.getElementById('toggle-btn');
            const testBtn = document.getElementById('test-btn');
            const clearBtn = document.getElementById('clear-btn');
            const destroyBtn = document.getElementById('destroy-btn');
            const debugBtn = document.getElementById('debug-btn');

            if (currentWidgetType === 'thursday') {
                toggleBtn.textContent = 'Switch to Friday/Saturday Schedule';
                toggleBtn.disabled = false;
                testBtn.disabled = !widgetLoaded;
                clearBtn.disabled = !widgetLoaded;
                destroyBtn.disabled = !widgetLoaded;
            } else if (currentWidgetType === 'friday-saturday') {
                toggleBtn.textContent = 'Switch to Thursday Schedule';
                toggleBtn.disabled = false;
                testBtn.disabled = !fridaySaturdayWidgetLoaded;
                clearBtn.disabled = !fridaySaturdayWidgetLoaded;
                destroyBtn.disabled = !fridaySaturdayWidgetLoaded;
            } else {
                toggleBtn.textContent = 'Load Thursday Schedule';
                toggleBtn.disabled = false;
                testBtn.disabled = true;
                clearBtn.disabled = true;
                destroyBtn.disabled = true;
            }

            debugBtn.textContent = debugEnabled ? 'Disable Debug' : 'Enable Debug';
        }

        function updateBackgroundMessage() {
            const backgroundMessage = document.getElementById('background-message');
            const anyWidgetLoaded = widgetLoaded || fridaySaturdayWidgetLoaded;

            if (anyWidgetLoaded) {
                backgroundMessage.style.display = 'none';
            } else {
                backgroundMessage.style.display = 'block';
            }
        }

        async function createWidget() {
            // Create new Thursday widget instance
            if (window.NZGDCWidget && window.NZGDCWidget.isReady()) {
                const container = document.getElementById('thursday-container');

                try {
                    // Clear any existing content except the header
                    const header = container.querySelector('h2');
                    container.innerHTML = '';
                    if (header) {
                        container.appendChild(header);
                    } else {
                        container.innerHTML = '<h2>Thursday Workshop Schedule</h2>';
                    }

                    // Create new widget instance using the modular API, passing the global dataManagerInstance
                    const widget = await NZGDCWidget.create(
                        container,
                        {
                            showFilters: true,
                            showFooter: true
                        },
                        dataManagerInstance
                    );
                    container.style.display = 'block';
                    return widget;
                } catch (error) {
                    console.error('Thursday widget creation failed:', error);
                    return null;
                }
            }
            return null;
        }

        async function createFridaySaturdayWidgetLocal() {
            try {
                updateStatus("Loading Friday/Saturday widget...");

                // Ensure DataManager is initialized first
                if (!dataManagerInstance) {
                    updateStatus("Initializing data manager...");
                    await initializeDataManager();
                    if (!dataManagerInstance) {
                        throw new Error('DataManager could not be initialized');
                    }
                }

                // Check if the new widget system is available
                if (typeof window.createFridaySaturdayWidget !== 'function') {
                    throw new Error('Friday/Saturday widget system is not ready. Please ensure all required scripts are loaded.');
                }

                // Create the unified Friday/Saturday widget, passing the DataManager instance
                currentFridaySaturdayWidget = await window.createFridaySaturdayWidget('friday-saturday-container', {
                    enableDebug: debugEnabled,
                    defaultView: 'morning'
                }, dataManagerInstance);

                fridaySaturdayWidgetLoaded = true;
                currentWidgetType = 'friday-saturday';

                document.getElementById('thursday-container').style.display = 'none';
                document.getElementById('friday-saturday-container').style.display = 'block';

                updateStatus("Friday/Saturday widget loaded successfully", "success");
                updateButtonStates();
                updateBackgroundMessage();

                if (debugEnabled) {
                    console.log('Friday/Saturday widget created successfully:', currentFridaySaturdayWidget);
                    console.log('DataManager instance passed:', dataManagerInstance);
                }
            } catch (error) {
                console.error('Error creating Friday/Saturday widget:', error);
                updateStatus(`Failed to create Friday/Saturday widget: ${error.message}`, "error");
            }
        }

        async function showThursdayWidget() {
            try {
                updateStatus("Loading Thursday Schedule Widget...");

                // Hide Friday/Saturday container
                document.getElementById('friday-saturday-container').style.display = 'none';

                // Show Thursday container
                document.getElementById('thursday-container').style.display = 'block';

                // Create widget if not already created
                if (!widgetLoaded) {
                    if (typeof window.NZGDCWidget !== 'undefined') {
                        window.NZGDCWidget.ready(async () => {
                            currentWidget = await createWidget();
                            if (currentWidget) {
                                widgetLoaded = true;
                                currentWidgetType = "thursday";
                                updateStatus('Thursday widget loaded successfully!', 'success');
                                updateButtonStates();
                                updateBackgroundMessage();
                            } else {
                                updateStatus('Failed to create Thursday widget', 'error');
                            }
                        });
                    } else {
                        updateStatus('Thursday widget API not available - ensure script is loaded', 'error');
                    }
                } else {
                    currentWidgetType = "thursday";
                    updateButtonStates();
                    updateBackgroundMessage();
                    updateStatus("Thursday Schedule Widget displayed successfully!", "success");
                }
            } catch (error) {
                console.error("Error showing Thursday widget:", error);
                updateStatus(`Failed to show Thursday widget: ${error.message}`, "error");
            }
        }

        async function showFridaySaturdayWidget() {
            try {
                updateStatus("Loading Friday/Saturday Schedule Widget...");

                // Hide Thursday container
                document.getElementById('thursday-container').style.display = 'none';

                // Show Friday/Saturday container
                document.getElementById('friday-saturday-container').style.display = 'block';

                // Create widget if not already created
                if (!fridaySaturdayWidgetLoaded) {
                    await createFridaySaturdayWidgetLocal();
                }

                currentWidgetType = 'friday-saturday';
                updateButtonStates();
                updateBackgroundMessage();

                updateStatus("Friday/Saturday Schedule Widget displayed successfully!", "success");
            } catch (error) {
                console.error("Error showing Friday/Saturday widget:", error);
                updateStatus(`Failed to show Friday/Saturday widget: ${error.message}`, "error");
            }
        }

        async function toggleWidget() {
            try {
                if (currentWidgetType === null || currentWidgetType === 'friday-saturday') {
                    // Show Thursday widget
                    await showThursdayWidget();
                } else if (currentWidgetType === 'thursday') {
                    // Show Friday/Saturday widget (unified)
                    await showFridaySaturdayWidget();
                }
            } catch (error) {
                console.error("Error toggling widget:", error);
                updateStatus(`Toggle error: ${error.message}`, "error");
            }
        }

        function testWidget() {
            if (currentWidgetType === 'thursday' && widgetLoaded) {
                updateStatus("Testing Thursday widget functionality...");

                if (currentWidget && typeof currentWidget.test === 'function') {
                    currentWidget.test();
                    updateStatus("Thursday widget test completed - check console for results", "success");
                } else {
                    updateStatus("Thursday widget test method not available", "error");
                }
            } else if (currentWidgetType === 'friday-saturday' && fridaySaturdayWidgetLoaded) {
                updateStatus("Testing Friday/Saturday widget functionality...");

                if (currentFridaySaturdayWidget && typeof currentFridaySaturdayWidget.test === 'function') {
                    currentFridaySaturdayWidget.test();
                    updateStatus("Friday/Saturday widget test completed - check console for results", "success");
                } else {
                    updateStatus("Friday/Saturday widget test method not available", "error");
                }
            } else {
                updateStatus("No widget loaded to test", "error");
            }
        }

        function clearWidget() {
            let clearedCount = 0;

            // Clear Thursday widget
            if (currentWidget) {
                try {
                    const container = document.getElementById('thursday-container');
                    const widgetElements = container.querySelectorAll('.nzgdc-schedule-widget');
                    widgetElements.forEach(el => el.remove());

                    // Reset container content to just the header
                    container.innerHTML = '<h2>Thursday Workshop Schedule</h2>';
                    clearedCount++;
                } catch (error) {
                    console.error('Error clearing Thursday widget:', error);
                }
            }

            // Clear Friday/Saturday widget
            if (currentFridaySaturdayWidget) {
                try {
                    const container = document.getElementById('friday-saturday-container');
                    const widgetElements = container.querySelectorAll('.nzgdc-morning-schedule-widget, .nzgdc-afternoon-schedule-widget');
                    widgetElements.forEach(el => el.remove());

                    // Reset container content to just the header
                    container.innerHTML = '<h2>Friday & Saturday Schedule</h2>';
                    clearedCount++;
                } catch (error) {
                    console.error('Error clearing Friday/Saturday widget:', error);
                }
            }

            if (clearedCount > 0) {
                updateStatus(`${clearedCount} widget(s) cleared`, 'success');
            } else {
                updateStatus('No widgets to clear', 'error');
            }
        }

        function destroyWidget() {
            let destroyedCount = 0;
            let errors = [];

            // Destroy Thursday widget
            if (currentWidget && typeof currentWidget.destroy === 'function') {
                try {
                    currentWidget.destroy();
                    destroyedCount++;
                    const container = document.getElementById('thursday-container');
                    container.innerHTML = '<h2>Thursday Workshop Schedule</h2>';
                    widgetLoaded = false;
                    currentWidget = null;
                } catch (error) {
                    console.error('Error destroying Thursday widget:', error);
                    errors.push('Thursday: ' + error.message);
                }
            }

            // Destroy Friday/Saturday widget
            if (currentFridaySaturdayWidget && typeof currentFridaySaturdayWidget.destroy === 'function') {
                try {
                    currentFridaySaturdayWidget.destroy();
                    destroyedCount++;
                    const container = document.getElementById('friday-saturday-container');
                    container.innerHTML = '<h2>Friday & Saturday Schedule</h2>';
                    fridaySaturdayWidgetLoaded = false;
                    currentFridaySaturdayWidget = null;
                } catch (error) {
                    console.error('Error destroying Friday/Saturday widget:', error);
                    errors.push('Friday/Saturday: ' + error.message);
                }
            }

            // Reset widget type and update UI
            currentWidgetType = null;

            // Hide all containers
            document.getElementById('thursday-container').style.display = 'none';
            document.getElementById('friday-saturday-container').style.display = 'none';

            updateButtonStates();
            updateBackgroundMessage();

            if (destroyedCount > 0) {
                updateStatus(`${destroyedCount} widget(s) destroyed and resources cleaned up`, 'success');
            } else {
                updateStatus('No widgets to destroy or destroy method not available', 'error');
            }

            if (errors.length > 0) {
                console.error('Destruction errors:', errors);
                updateStatus('Some widgets had destruction errors: ' + errors.join(', '), 'error');
            }
        }

        function showInfo() {
            alert(`NZGDC Schedule Widgets Demo

Current Status:
- Thursday widget: ${widgetLoaded ? 'Loaded' : 'Not loaded'}
- Friday/Saturday widget: ${fridaySaturdayWidgetLoaded ? 'Loaded' : 'Not loaded'}
- Current view: ${currentWidgetType || 'None'}
- Debug mode: ${debugEnabled ? 'Enabled' : 'Disabled'}

Key Features:
- Unified event panel styling system
- Seamless widget switching
- Expanded event details overlay
- New API integration
- Responsive design

Use the buttons above to test different widget functionality.`);
        }

        function showConsole() {
            console.log('=== NZGDC Widget Demo Status ===');
            console.log('Thursday widget loaded:', widgetLoaded);
            console.log('Friday/Saturday widget loaded:', fridaySaturdayWidgetLoaded);
            console.log('Current widget type:', currentWidgetType);
            console.log('Debug enabled:', debugEnabled);
            console.log('DataManager instance:', dataManagerInstance);
            checkScriptLoadingStatus();
        }

        function toggleDebug() {
            debugEnabled = !debugEnabled;
            window.NZGDC_DEBUG = debugEnabled;

            updateButtonStates();

            if (debugEnabled) {
                updateStatus('Debug mode enabled - check console for detailed logs', 'info');
                console.log('%c[NZGDC Debug] Debug mode enabled', 'color: green; font-weight: bold;');
            } else {
                updateStatus('Debug mode disabled', 'info');
                console.log('%c[NZGDC Debug] Debug mode disabled', 'color: orange; font-weight: bold;');
            }
        }

        function verifyData() {
            console.log('=== BASIC DATA VERIFICATION ===');

            if (!dataManagerInstance) {
                updateStatus('DataManager not available', 'error');
                return;
            }

            const allEvents = dataManagerInstance.getAllEvents();
            const schedules = dataManagerInstance.getScheduleData();

            console.log(`Events: ${allEvents.length}, Schedules: ${schedules.length}`);

            // Check widget availability
            const widgetStatus = {
                thursday: typeof window.NZGDCWidget !== 'undefined',
                morning: typeof window.NZGDCMorningWidget !== 'undefined',
                afternoon: typeof window.NZGDCAfternoonWidget !== 'undefined'
            };

            console.log('Widget APIs available:', widgetStatus);

            // Count DOM elements
            const domCounts = {
                thursday: document.querySelectorAll('.nzgdc-schedule-widget').length,
                morning: document.querySelectorAll('.nzgdc-morning-schedule-widget').length,
                afternoon: document.querySelectorAll('.nzgdc-afternoon-schedule-widget').length
            };

            console.log('DOM instances:', domCounts);
            updateStatus(`Verification complete - ${allEvents.length} events available`, 'success');
        }

        // Comprehensive Thursday event analysis
        function quickDebug() {
            console.log('%c=== COMPREHENSIVE FRIDAY/SATURDAY EVENT ANALYSIS ===', 'color: purple; font-weight: bold; font-size: 16px;');

            if (!dataManagerInstance) {
                console.log('❌ No DataManager instance available');
                return;
            }

            const schedules = dataManagerInstance.getScheduleData();
            console.log(`Widget states: Thu=${widgetLoaded}, Fri/Sat=${fridaySaturdayWidgetLoaded}`);
            console.log(`Current type: ${currentWidgetType}`);
            console.log(`DataManager instance:`, dataManagerInstance);

            // Find Friday/Saturday schedules
            let fridaySaturdaySchedules = [];
            if (schedules && schedules.length > 0) {
                console.log('\n📅 SCHEDULE ANALYSIS:');
                schedules.forEach((schedule, index) => {
                    const scheduleDate = new Date(schedule.date);
                    const dayName = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][scheduleDate.getDay()];
                    const dayOfWeek = scheduleDate.getDay();
                    console.log(`Schedule ${index}: "${schedule.title}", Date: ${schedule.date} (${dayName})`);
                    console.log(`  Sessions in schedule: ${schedule.sessions ? schedule.sessions.length : 'N/A'}`);

                    if (dayOfWeek === 5 || dayOfWeek === 6) { // Friday or Saturday
                        fridaySaturdaySchedules.push(schedule);
                        console.log(`  🎯 FRIDAY/SATURDAY SCHEDULE FOUND!`);
                        console.log(`  ${dayName} has ${schedule.sessions ? schedule.sessions.length : 0} sessions`);
                    }
                });
            }

            // Detailed Friday/Saturday analysis
            if (fridaySaturdaySchedules.length > 0) {
                console.log(`\n🔥 FRIDAY/SATURDAY SCHEDULE BREAKDOWN:`);
                console.log(`Found ${fridaySaturdaySchedules.length} Friday/Saturday schedules`);

                let morningEvents = [];
                let afternoonEvents = [];

                fridaySaturdaySchedules.forEach(schedule => {
                    if (schedule.sessions) {
                        schedule.sessions.forEach((session, index) => {
                            const startTime = session.startTime || "00:00";
                            const hour = parseInt(startTime.split(":")[0], 10);

                            console.log(`  "${session.title}" - ${session.startTime}-${session.endTime} (Hour: ${hour})`);
                            console.log(`    Has copy: ${!!session.copy}`);
                            console.log(`    Stream: ${session.stream ? session.stream.title : 'N/A'}`);
                            console.log(`    Speakers: ${session.speakers ? session.speakers.length : 0}`);

                            if (session.speakers) {
                                session.speakers.forEach(speaker => {
                                    console.log(`      - ${speaker.displayName}: Has bio: ${!!speaker.copy}`);
                                });
                            }

                            if (hour < 12) {
                                morningEvents.push(session);
                            } else {
                                afternoonEvents.push(session);
                            }
                        });
                    }
                });

                console.log(`\n🌅 MORNING EVENTS: ${morningEvents.length}`);
                console.log(`🌇 AFTERNOON EVENTS: ${afternoonEvents.length}`);

                // Test if Friday/Saturday widget is actually using this data
                if (currentFridaySaturdayWidget && currentFridaySaturdayWidget.dataManager) {
                    console.log(`\n✅ Widget has DataManager connection`);
                    console.log(`Widget DataManager:`, currentFridaySaturdayWidget.dataManager);
                } else {
                    console.log(`\n❌ Widget missing DataManager connection!`);
                    if (currentFridaySaturdayWidget) {
                        console.log(`Widget object:`, currentFridaySaturdayWidget);
                    }
                }
            }

            // Count DOM elements
            const thursdayEvents = document.querySelectorAll('#thursday-container .nzgdc-event-panel-container').length;
            const morningEvents = document.querySelectorAll('#friday-saturday-container .nzgdc-morning-event-panel-container, #friday-saturday-container .nzgdc-morning-event-panel-main-container').length;
            const afternoonEvents = document.querySelectorAll('#friday-saturday-container .nzgdc-afternoon-event-panel-container, #friday-saturday-container .nzgdc-afternoon-event-panel-main-container').length;

            console.log(`\n🏗️ DOM ELEMENTS:`);
            console.log(`Rendered Thu panels: ${thursdayEvents}`);
            console.log(`Rendered Morning panels: ${morningEvents}`);
            console.log(`Rendered Afternoon panels: ${afternoonEvents}`);

            const summary = `F/S Analysis: ${fridaySaturdaySchedules.length} schedules, ${morningEvents} morning, ${afternoonEvents} afternoon panels rendered`;
            updateStatus(summary, fridaySaturdaySchedules.length > 0 ? 'success' : 'error');
        }

        window.quickDebug = quickDebug;

        // Initialize button states
        updateButtonStates();
        updateBackgroundMessage();

        // Initialize DataManager when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(initializeDataManager, 100);
        });

        // Update widget status in footer
        function updateWidgetStatus() {
            const statusEl = document.getElementById('widget-status');
            if (widgetLoaded && currentWidgetType === 'thursday') {
                statusEl.textContent = 'Thursday widget loaded';
            } else if (fridaySaturdayWidgetLoaded && currentWidgetType === 'friday-saturday') {
                statusEl.textContent = 'Friday/Saturday widget loaded';
            } else {
                statusEl.textContent = 'Not loaded';
            }
        }

        // Add comprehensive debug function for Friday/Saturday data flow
        function debugFridaySaturdayDataFlow() {
            console.log('%c=== FRIDAY/SATURDAY DATA FLOW DEBUG ===', 'color: red; font-weight: bold; font-size: 16px;');

            // 1. Check DataManager status
            console.log('\n1️⃣ DATAMANAGER STATUS:');
            if (!dataManagerInstance) {
                console.log('❌ DataManager instance not available');
                return;
            }
            console.log('✅ DataManager instance available');

            // 2. Check raw API data
            console.log('\n2️⃣ RAW API DATA:');
            try {
                const schedules = dataManagerInstance.getScheduleData();
                console.log(`Total schedules: ${schedules.length}`);

                const fridaySaturday = schedules.filter(s => {
                    const date = new Date(s.date);
                    const day = date.getDay();
                    return day === 5 || day === 6;
                });

                console.log(`Friday/Saturday schedules: ${fridaySaturday.length}`);
                fridaySaturday.forEach(schedule => {
                    console.log(`  ${schedule.title} (${schedule.date}): ${schedule.sessions?.length || 0} sessions`);
                });
            } catch (error) {
                console.log('❌ Error getting schedule data:', error);
            }

            // 3. Check widget instance
            console.log('\n3️⃣ WIDGET INSTANCE:');
            if (!currentFridaySaturdayWidget) {
                console.log('❌ Friday/Saturday widget not created');
                return;
            }
            console.log('✅ Widget instance exists');
            console.log('Widget has DataManager:', !!currentFridaySaturdayWidget.dataManager);

            // 4. Test widget's data filtering
            console.log('\n4️⃣ WIDGET DATA FILTERING:');
            if (currentFridaySaturdayWidget.dataManager) {
                try {
                    const testSchedules = currentFridaySaturdayWidget.dataManager.getScheduleData();
                    console.log(`Widget can access ${testSchedules.length} schedules`);

                    // Test morning events filtering
                    const morningData = {};
                    testSchedules.forEach(schedule => {
                        const scheduleDate = new Date(schedule.date);
                        const dayOfWeek = scheduleDate.getDay();

                        if ((dayOfWeek === 5 || dayOfWeek === 6) && schedule.sessions) {
                            schedule.sessions.forEach(session => {
                                const startTime = session.startTime || "00:00";
                                const hour = parseInt(startTime.split(":")[0], 10);

                                if (hour < 12) {
                                    morningData[session.id] = {
                                        title: session.title,
                                        copy: session.copy,
                                        speakers: session.speakers?.length || 0
                                    };
                                }
                            });
                        }
                    });

                    console.log(`Filtered morning events: ${Object.keys(morningData).length}`);
                    console.log('Sample morning events:', Object.values(morningData).slice(0, 2));

                } catch (error) {
                    console.log('❌ Error testing widget filtering:', error);
                }
            } else {
                console.log('❌ Widget missing DataManager connection!');
            }

            // 5. Check DOM rendering
            console.log('\n5️⃣ DOM RENDERING:');
            const morningPanels = document.querySelectorAll('#friday-saturday-container .nzgdc-morning-event-panel-container, #friday-saturday-container .nzgdc-morning-event-panel-main-container').length;
            const afternoonPanels = document.querySelectorAll('#friday-saturday-container .nzgdc-afternoon-event-panel-container, #friday-saturday-container .nzgdc-afternoon-event-panel-main-container').length;

            console.log(`Rendered morning panels: ${morningPanels}`);
            console.log(`Rendered afternoon panels: ${afternoonPanels}`);

            // 6. Test expanded event details
            console.log('\n6️⃣ EXPANDED EVENT DETAILS:');
            console.log('ExpandedEventDetailsManager available:', typeof ExpandedEventDetailsManager !== 'undefined');

            if (typeof ExpandedEventDetailsManager !== 'undefined') {
                const manager = new ExpandedEventDetailsManager();

                // Test with sample API session data
                const testSession = {
                    title: "Test Event",
                    copy: "<p>This is a test event description with <strong>HTML</strong> formatting.</p>",
                    speakers: [{
                        displayName: "Test Speaker",
                        copy: "<p>This is a test speaker bio with <strong>HTML</strong> formatting.</p>",
                        speakerImage: "https://example.com/speaker.jpg"
                    }]
                };

                const adaptedData = manager.adaptEventData(testSession);
                console.log('Event adaptation test:', {
                    title: adaptedData.title,
                    hasDescription: adaptedData.description !== 'Event description not available.',
                    speakerCount: adaptedData.speakers.length
                });

                if (adaptedData.speakers.length > 0) {
                    const adaptedSpeaker = adaptedData.speakers[0];
                    console.log('Speaker adaptation test:', {
                        name: adaptedSpeaker.name,
                        hasBio: adaptedSpeaker.bio !== 'Speaker bio not available.',
                        hasHeadshot: !!adaptedSpeaker.headshot
                    });
                }
            }

            console.log('\n🎯 DIAGNOSIS COMPLETE - Check console output above for issues');
        }

        window.debugFridaySaturdayDataFlow = debugFridaySaturdayDataFlow;

        // Update status periodically
        setInterval(updateWidgetStatus, 1000);
    </script>
</body>
</html>
