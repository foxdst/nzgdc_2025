<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NZGDC Schedule Widgets Demo</title>
    <!-- Load unified event panel styles FIRST - contains all centralized event panel component styles -->
    <link rel="stylesheet" href="../css/unified-event-panel.css">
    <!-- Load widget-specific bundles AFTER unified - these only contain layout/positioning, not component styles -->
    <link rel="stylesheet" href="../css/thursday-schedule-bundle.css">
    <link rel="stylesheet" href="../css/morning-schedule-bundle.css">
    <link rel="stylesheet" href="../css/afternoon-schedule-bundle.css">
    <style>
        /* NZGDC Color Variables */
        :root {
            --color-yellow: rgba(255, 236, 81, 1);
            --color-blue: rgba(23, 75, 235, 1);
            --color-blue-hover: rgba(20, 65, 200, 1);
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-yellow-bright: rgba(240, 223, 86, 1);
            --font-primary: 'Futura PT Heavy', 'Futura', Arial, sans-serif;
        }

        body {
            font-family: var(--font-primary);
            margin: 0;
            padding: 0;
            background-color: var(--color-white);
        }

        .demo-header {
            background: var(--color-blue);
            color: var(--color-white);
            padding: 20px;
            text-align: center;
        }

        .demo-header h1 {
            margin: 0;
            font-size: 36px;
            font-weight: 800;
            font-family: var(--font-primary);
        }

        .demo-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .demo-controls button {
            background: var(--color-yellow-bright);
            color: var(--color-black);
            border: none;
            padding: 10px 20px;
            border-radius: 0;
            cursor: pointer;
            font-size: 16px;
            font-family: var(--font-primary);
            font-weight: 600;
            text-transform: uppercase;
            transition: background-color 0.3s ease;
            margin: 0 5px;
        }

        .demo-controls button:hover {
            background: var(--color-yellow);
        }

        .demo-controls button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            background: var(--color-white);
            padding: 15px;
            text-align: center;
            font-size: 16px;
            font-family: var(--font-primary);
            font-weight: 600;
            border-bottom: 5px solid var(--color-yellow);
        }

        .status.success {
            background: var(--color-yellow);
            color: var(--color-black);
        }
        .status.error {
            background: #F53E3E;
            color: var(--color-white);
        }

        .demo-content {
            min-height: 60vh;
            padding: 0;
            background-color: var(--color-white);
            position: relative;
        }

        .no-widgets-message {
            position: relative;
            margin: 40px auto;
            text-align: left;
            color: var(--color-black);
            font-family: var(--font-primary);
            background: rgba(240, 223, 86, 0.1);
            padding: 30px;
            border: 2px dashed var(--color-yellow-bright);
            border-radius: 8px;
            max-width: 600px;
        }

        .no-widgets-message h3 {
            margin: 0 0 20px 0;
            font-size: 24px;
            font-weight: 800;
            color: var(--color-blue);
            text-align: center;
        }

        .no-widgets-message p {
            margin: 0 0 15px 0;
            font-size: 16px;
            line-height: 1.5;
        }

        .no-widgets-message ul {
            margin: 0 0 20px 0;
            padding-left: 20px;
            font-size: 16px;
            line-height: 1.6;
        }

        .no-widgets-message li {
            margin: 0 0 10px 0;
        }

        .no-widgets-message .instructions {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px dashed var(--color-yellow-bright);
        }

        .no-widgets-message .demo-controls {
            margin-top: 25px;
            justify-content: center;
        }

        .no-widgets-message .demo-controls button {
            font-size: 14px;
            padding: 8px 16px;
        }

        .demo-footer {
            background: var(--color-blue);
            color: var(--color-white);
            text-align: center;
            padding: 20px;
            font-family: var(--font-primary);
            font-size: 16px;
            font-weight: 600;
        }

        .demo-footer button {
            background: var(--color-yellow-bright);
            color: var(--color-black);
            border: none;
            padding: 8px 16px;
            border-radius: 0;
            cursor: pointer;
            font-size: 14px;
            font-family: var(--font-primary);
            font-weight: 600;
            text-transform: uppercase;
            margin: 0 5px;
            transition: background-color 0.3s ease;
        }

        .demo-footer button:hover {
            background: var(--color-yellow);
        }

        .widget-section {
            margin-bottom: 40px;
            display: none;
        }

        .widget-section h2 {
            text-align: center;
            padding: 20px;
            margin: 0;
            font-family: var(--font-primary);
            font-weight: 800;
        }

        .thursday-section h2 {
            background: #174BEB;
            color: white;
        }

        .morning-section h2 {
            background: #F0DF56;
            color: black;
        }

        .afternoon-section h2 {
            background: #174BEB;
            color: white;
        }

        @media (max-width: 768px) {
            .demo-controls {
                flex-direction: column;
                align-items: center;
            }

            .demo-controls button {
                width: 90%;
                max-width: 300px;
                margin: 5px 0;
            }

            .no-widgets-message {
                margin: 20px;
                padding: 20px;
            }

            .no-widgets-message h3 {
                font-size: 20px;
            }

            .no-widgets-message p {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <header class="demo-header">
        <h1>NZGDC Schedule Widgets Demo</h1>
        <div class="demo-controls">
            <!--
                Toggle Button:
                - Initial label is "Show Thursday Schedule"
                - When Thursday is shown, label becomes "Show Friday/Saturday Morning Schedule"
                - When Friday/Saturday Morning is shown, label becomes "Show Thursday Schedule"
                - Only one schedule widget is visible at a time.
            -->
            <button id="toggleBtn" onclick="toggleWidget()">Show Thursday Schedule</button>
            <button id="testBtn" onclick="testWidget()">Test Widgets</button>
            <button id="testUnifiedBtn" onclick="testUnifiedSystem()">Test Unified System</button>
            <button id="clearBtn" onclick="clearWidget()">Clear All</button>
            <button id="destroyBtn" onclick="destroyWidget()">Destroy All</button>
            <button id="verifyBtn" onclick="verifyData()">Verify Data</button>
            <button id="debugBtn" onclick="toggleDebug()">Enable Debug</button>
            <button id="testExpandedBtn" onclick="testExpandedEventDetails()">Test Expanded Details</button>
        </div>
    </header>

    <div class="status" id="status">Ready to load NZGDC Schedule Widgets...</div>

    <div class="demo-content">
        <!-- Background message when no widgets are loaded -->
        <div class="no-widgets-message" id="no-widgets-message">
            <h3>🎮 NZGDC Schedule Widgets</h3>
            <p>This demo allows you to toggle between two schedule designs:</p>

            <ul>
                <li><strong>Thursday Schedule:</strong> Workshop schedule with 10 events across morning and afternoon time slots</li>
                <li><strong>Friday/Saturday Schedule:</strong> Unified event schedule with Morning Events and Afternoon Events tabs</li>
            </ul>

            <div class="instructions">
                <p><strong>How to use:</strong></p>
                <ul>
                    <li>Use the <strong>toggle button</strong> above to switch between Thursday and Friday/Saturday schedules</li>
                    <li>In Friday/Saturday view, use the <strong>Morning Events</strong> and <strong>Afternoon Events</strong> buttons to switch views</li>
                    <li>Only one schedule is visible at a time</li>
                    <li>Use the other controls to test, clear, or destroy the current schedule widget</li>
                </ul>

                <p><strong>Note:</strong> Friday/Saturday schedule now includes seamless view switching using existing navigation buttons.</p>
            </div>
        </div>

        <!-- Thursday Schedule Widget -->
        <div class="widget-section thursday-section" id="thursday-container">
            <h2>Thursday Workshop Schedule</h2>
            <!-- Widget content will be inserted here -->
        </div>

        <!-- Friday/Saturday Schedule Widget -->
        <div class="widget-section friday-saturday-section" id="friday-saturday-container">
            <h2>Friday & Saturday Schedule</h2>
            <!-- Unified widget content will be inserted here -->
        </div>
    </div>

    <footer class="demo-footer">
        <span>Widgets Status: <span id="widget-status">Not loaded</span></span>
        <button onclick="showInfo()">Show Info</button>
        <button onclick="showConsole()">Console</button>
        <button onclick="location.reload()">Refresh</button>
    </footer>

    <script>
        let widgetLoaded = false;
        let fridaySaturdayWidgetLoaded = false;
        let currentWidget = null;
        let currentFridaySaturdayWidget = null;
        let debugEnabled = false;

        // Track which widget is currently shown: "thursday" or "friday-saturday"
        let currentWidgetType = null;

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            const widgetStatusEl = document.getElementById('widget-status');

            statusEl.textContent = message;
            statusEl.className = `status ${type}`;

            if (type === 'success') {
                const thursdayLoaded = widgetLoaded;
                const fridaySatLoaded = fridaySaturdayWidgetLoaded;
                const loadedCount = [thursdayLoaded, fridaySatLoaded].filter(Boolean).length;
                if (loadedCount === 2) {
                    widgetStatusEl.textContent = 'All Loaded';
                } else if (loadedCount === 1) {
                    widgetStatusEl.textContent = 'One Loaded';
                } else {
                    widgetStatusEl.textContent = 'None Loaded';
                }
            } else if (type === 'error') {
                widgetStatusEl.textContent = 'Error';
            }

            updateButtonStates();
            updateBackgroundMessage();
        }

        function updateButtonStates() {
            const toggleBtn = document.getElementById('toggleBtn');
            const testBtn = document.getElementById('testBtn');
            const clearBtn = document.getElementById('clearBtn');
            const destroyBtn = document.getElementById('destroyBtn');
            const verifyBtn = document.getElementById('verifyBtn');
            const debugBtn = document.getElementById('debugBtn');

            const anyWidgetLoaded = widgetLoaded || fridaySaturdayWidgetLoaded;
            testBtn.disabled = !anyWidgetLoaded;
            clearBtn.disabled = !anyWidgetLoaded;
            destroyBtn.disabled = !anyWidgetLoaded;

            // Update toggle button text based on which widget is currently shown
            // --- Button Label Logic ---
            // - If Thursday is loaded, label is "Show Friday/Saturday Schedule"
            // - If Friday/Saturday is loaded, label is "Show Thursday Schedule"
            // - If none is loaded, label is "Show Thursday Schedule" (initial state)
            if (toggleBtn) {
                if (widgetLoaded) {
                    toggleBtn.textContent = "Show Friday/Saturday Schedule";
                } else if (fridaySaturdayWidgetLoaded) {
                    toggleBtn.textContent = "Show Thursday Schedule";
                } else {
                    // Default to Thursday first
                    toggleBtn.textContent = "Show Thursday Schedule";
                }
            }

            // Verify and debug buttons are always enabled
            debugBtn.textContent = debugEnabled ? 'Disable Debug' : 'Enable Debug';
        }

        function updateBackgroundMessage() {
            const backgroundMessage = document.getElementById('no-widgets-message');
            const anyWidgetLoaded = widgetLoaded || fridaySaturdayWidgetLoaded;

            if (anyWidgetLoaded) {
                backgroundMessage.style.display = 'none';
            } else {
                backgroundMessage.style.display = 'block';
            }
        }

        async function createWidget() {
            // Create new Thursday widget instance
            if (window.NZGDCWidget && window.NZGDCWidget.isReady()) {
                const container = document.getElementById('thursday-container');

                try {
                    // Clear any existing content except the header
                    const header = container.querySelector('h2');
                    container.innerHTML = '';
                    if (header) {
                        container.appendChild(header);
                    } else {
                        container.innerHTML = '<h2>Thursday Workshop Schedule</h2>';
                    }

                    // Create new widget instance using the modular API
                    const widget = await NZGDCWidget.create(container, {
                        showFilters: true,
                        showFooter: true
                    });
                    container.style.display = 'block';
                    updateBackgroundMessage();
                    return widget;
                } catch (error) {
                    console.error('Thursday widget creation failed:', error);
                    return null;
                }
            }
            return null;
        }

        async function createFridaySaturdayWidgetLocal() {
            try {
                updateStatus("Creating Friday/Saturday Schedule Widget...");

                // Ensure Friday/Saturday container is visible and ready
                const fridaySaturdayContainer = document.getElementById('friday-saturday-container');
                if (fridaySaturdayContainer) {
                    fridaySaturdayContainer.style.display = 'block';
                }

                // Create unified Friday/Saturday widget
                currentFridaySaturdayWidget = await window.createFridaySaturdayWidget('friday-saturday-container', {
                    enableDebug: debugEnabled,
                    defaultView: 'morning'
                });

                fridaySaturdayWidgetLoaded = true;
                currentWidgetType = 'friday-saturday';

                updateStatus("Friday/Saturday Schedule Widget loaded successfully!", "success");
                updateButtonStates();
                updateBackgroundMessage();

                return currentFridaySaturdayWidget;
            } catch (error) {
                console.error("Error creating Friday/Saturday widget:", error);
                updateStatus(`Failed to create Friday/Saturday widget: ${error.message}`, "error");
                throw error;
            }
        }

       /**
        * Show Thursday Schedule Widget
        * - Destroys the morning widget if loaded
        * - Hides the morning container
        * - Loads the Thursday widget and updates toggle button label
        */
        async function showThursdayWidget() {
            try {
                updateStatus("Loading Thursday Schedule Widget...");

                // Hide Friday/Saturday container
                document.getElementById('friday-saturday-container').style.display = 'none';

                // Show Thursday container
                document.getElementById('thursday-container').style.display = 'block';

                // Create widget if not already created
                if (!widgetLoaded) {
                    if (typeof window.NZGDCWidget !== 'undefined') {
                        window.NZGDCWidget.ready(async () => {
                            currentWidget = await createWidget();
                            if (currentWidget) {
                                widgetLoaded = true;
                                currentWidgetType = "thursday";
                                updateStatus('Thursday widget loaded successfully!', 'success');
                                updateButtonStates();
                            } else {
                                updateStatus('Failed to create Thursday widget', 'error');
                            }
                        });
                    } else {
                        updateStatus('Thursday widget API not available - ensure script is loaded', 'error');
                    }
                } else {
                    currentWidgetType = "thursday";
                    updateButtonStates();
                    updateBackgroundMessage();
                    updateStatus("Thursday Schedule Widget displayed successfully!", "success");
                }
            } catch (error) {
                console.error("Error showing Thursday widget:", error);
                updateStatus(`Failed to show Thursday widget: ${error.message}`, "error");
            }
        }

       /**
       * Show Friday/Saturday Schedule Widget
       * - Hides Thursday container
       * - Shows Friday/Saturday container with unified widget
       */
       async function showFridaySaturdayWidget() {
           try {
               updateStatus("Loading Friday/Saturday Schedule Widget...");

               // Hide Thursday container
               document.getElementById('thursday-container').style.display = 'none';

               // Show Friday/Saturday container
               document.getElementById('friday-saturday-container').style.display = 'block';

               // Create widget if not already created
               if (!fridaySaturdayWidgetLoaded) {
                   await createFridaySaturdayWidgetLocal();
               }

               currentWidgetType = 'friday-saturday';
               updateButtonStates();
               updateBackgroundMessage();

               updateStatus("Friday/Saturday Schedule Widget displayed successfully!", "success");
           } catch (error) {
               console.error("Error showing Friday/Saturday widget:", error);
               updateStatus(`Failed to show Friday/Saturday widget: ${error.message}`, "error");
           }
       }

        async function toggleWidget() {
            try {
                if (currentWidgetType === null || currentWidgetType === 'friday-saturday') {
                    // Show Thursday widget
                    await showThursdayWidget();
                } else if (currentWidgetType === 'thursday') {
                    // Show Friday/Saturday widget (unified)
                    await showFridaySaturdayWidget();
                }
            } catch (error) {
                console.error("Error toggling widget:", error);
                updateStatus(`Toggle error: ${error.message}`, "error");
            }
        }

        function testWidget() {
            if (!widgetLoaded && !fridaySaturdayWidgetLoaded) {
                updateStatus('Load at least one widget first', 'error');
                return;
            }

            const thursdayWidgets = document.querySelectorAll('.nzgdc-schedule-widget');
            const fridaySaturdayWidgets = document.querySelectorAll('.nzgdc-friday-saturday-schedule-widget');
            const morningWidgets = document.querySelectorAll('.nzgdc-morning-schedule-widget');
            const afternoonWidgets = document.querySelectorAll('.nzgdc-afternoon-schedule-widget');
            const workshops = document.querySelectorAll('.nzgdc-event-panel-big');
            const eventPanels = document.querySelectorAll('.nzgdc-event-panel-main, .nzgdc-event-panel-big');

            console.log('Widget test results:', {
                'Thursday widget instances': thursdayWidgets.length,
                'Friday/Saturday widget instances': fridaySaturdayWidgets.length,
                'Morning widget components': morningWidgets.length,
                'Afternoon widget components': afternoonWidgets.length,
                'Thursday workshop panels': workshops.length,
                'Event panels (unified)': eventPanels.length,
                'Thursday API available': typeof window.NZGDCWidget !== 'undefined',
                'Friday/Saturday API available': typeof window.createFridaySaturdayWidget !== 'undefined',
                'Thursday ready': window.NZGDCWidget ? window.NZGDCWidget.isReady() : false
            });

            const totalWidgets = thursdayWidgets.length + fridaySaturdayWidgets.length;
            const totalPanels = workshops.length + eventPanels.length;
            updateStatus(`Test complete: ${totalWidgets} widgets, ${totalPanels} events`, 'success');
        }

        function clearWidget() {
            const thursdayContainer = document.getElementById('thursday-container');
            const fridaySaturdayContainer = document.getElementById('friday-saturday-container');

            if (currentWidget && typeof currentWidget.destroy === 'function') {
                try { currentWidget.destroy(); } catch (e) {}
                currentWidget = null;
            }
            if (currentFridaySaturdayWidget && typeof currentFridaySaturdayWidget.destroy === 'function') {
                try { currentFridaySaturdayWidget.destroy(); } catch (e) {}
                currentFridaySaturdayWidget = null;
            }

            thursdayContainer.style.display = 'none';
            thursdayContainer.innerHTML = '<h2>Thursday Workshop Schedule</h2>';

            fridaySaturdayContainer.style.display = 'none';
            fridaySaturdayContainer.innerHTML = '<h2>Friday & Saturday Schedule</h2>';

            updateStatus('All widgets cleared - click toggle button to show a schedule', 'info');
            document.getElementById('widget-status').textContent = 'Cleared';
            widgetLoaded = false;
            fridaySaturdayWidgetLoaded = false;
            currentWidgetType = null;
            updateBackgroundMessage();
            updateButtonStates();
        }

        function destroyWidget() {
            let destroyedCount = 0;
            let errors = [];

            // Destroy Thursday widget
            if (currentWidget && typeof currentWidget.destroy === 'function') {
                try {
                    currentWidget.destroy();
                    destroyedCount++;
                    const container = document.getElementById('thursday-container');
                    container.style.display = 'none';
                    widgetLoaded = false;
                    currentWidget = null;
                } catch (error) {
                    console.error('Error destroying Thursday widget:', error);
                    errors.push('Thursday: ' + error.message);
                }
            }

            // Destroy Friday/Saturday widget
            if (currentFridaySaturdayWidget && typeof currentFridaySaturdayWidget.destroy === 'function') {
                try {
                    currentFridaySaturdayWidget.destroy();
                    destroyedCount++;
                    const container = document.getElementById('friday-saturday-container');
                    container.style.display = 'none';
                    fridaySaturdayWidgetLoaded = false;
                    currentFridaySaturdayWidget = null;
                } catch (error) {
                    console.error('Error destroying Friday/Saturday widget:', error);
                    errors.push('Friday/Saturday: ' + error.message);
                }
            }

            if (destroyedCount > 0) {
                updateStatus(`${destroyedCount} widget(s) destroyed and resources cleaned up`, 'info');
                document.getElementById('widget-status').textContent = 'Destroyed';
                updateBackgroundMessage();
            } else {
                updateStatus('No widgets to destroy or destroy method not available', 'error');
            }

            if (errors.length > 0) {
                console.error('Destruction errors:', errors);
                updateStatus('Some widgets had destruction errors: ' + errors.join(', '), 'error');
            }
        }

        function showInfo() {
            let hasInfo = false;

            if (window.NZGDCWidget) {
                const debugInfo = window.NZGDCWidget.getDebugInfo();
                const info = {
                    'Thursday ready': debugInfo.ready,
                    'Thursday schedule data': debugInfo.modules.scheduleData,
                    'Thursday workshop events': debugInfo.modules.workshopEvents,
                    'Thursday workshop loader': debugInfo.modules.workshopLoader,
                    'Thursday generator': debugInfo.modules.scheduleGenerator,
                    'Thursday widget core': debugInfo.modules.widgetCore
                };
                console.log('=== THURSDAY WIDGET DEBUG INFO ===');
                console.table(info);
                console.log('Full Thursday debug info:', debugInfo);
                hasInfo = true;
            }

            if (window.NZGDCMorningWidget) {
                const morningDebugInfo = window.NZGDCMorningWidget.getDebugInfo();
                const morningInfo = {
                    'Morning ready': morningDebugInfo.ready,
                    'Morning schedule data': morningDebugInfo.modules.morningScheduleData,
                    'Morning events': morningDebugInfo.modules.morningEvents,
                    'Morning event loader': morningDebugInfo.modules.morningEventLoader,
                    'Morning generator': morningDebugInfo.modules.morningScheduleGenerator,
                    'Morning widget core': morningDebugInfo.modules.morningWidgetCore
                };
                console.log('=== MORNING WIDGET DEBUG INFO ===');
                console.table(morningInfo);
                console.log('Full Morning debug info:', morningDebugInfo);
                hasInfo = true;
            }

            if (window.NZGDCAfternoonWidget) {
                const afternoonDebugInfo = window.NZGDCAfternoonWidget.getDebugInfo();
                const afternoonInfo = {
                    'Afternoon ready': afternoonDebugInfo.ready,
                    'Afternoon schedule data': afternoonDebugInfo.modules.afternoonScheduleData,
                    'Afternoon events': afternoonDebugInfo.modules.afternoonEvents,
                    'Afternoon event loader': afternoonDebugInfo.modules.afternoonEventLoader,
                    'Afternoon generator': afternoonDebugInfo.modules.afternoonScheduleGenerator,
                    'Afternoon widget core': afternoonDebugInfo.modules.afternoonWidgetCore
                };
                console.log('=== AFTERNOON WIDGET DEBUG INFO ===');
                console.table(afternoonInfo);
                console.log('Full Afternoon debug info:', afternoonDebugInfo);
                hasInfo = true;
            }

            if (hasInfo) {
                alert('Widget info logged to console (F12)');
            } else {
                alert('No widgets loaded');
            }
        }

        function showConsole() {
            alert('Press F12 to open browser console for detailed logs');
        }

        function toggleDebug() {
            debugEnabled = !debugEnabled;
            window.NZGDC_DEBUG = debugEnabled;

            updateButtonStates();

            if (debugEnabled) {
                updateStatus('Debug mode enabled - check console for detailed logs', 'info');
                console.log('%c[NZGDC Debug] Debug mode enabled', 'color: green; font-weight: bold;');
                console.log('[NZGDC Debug] Available debug info:');
                console.log('- Widget loader: Detailed module loading progress');
                console.log('- Workshop/Event loader: Element queries and data population');
                console.log('- Schedule generator: Event container processing');
                console.log('- Widget core: Initialization and lifecycle events');
            } else {
                updateStatus('Debug mode disabled', 'info');
                console.log('%c[NZGDC Debug] Debug mode disabled', 'color: orange; font-weight: bold;');
            }
        }

        function verifyData() {
            console.log('%c=== NZGDC WIDGET DATA VERIFICATION ===', 'color: blue; font-weight: bold; font-size: 14px;');

            // System status check
            const systemStatus = {
                thursdayScheduleData: typeof window.SCHEDULE_DATA !== 'undefined',
                thursdayWorkshopEvents: typeof window.WORKSHOP_EVENTS !== 'undefined',
                morningScheduleData: typeof window.MORNING_SCHEDULE_DATA !== 'undefined',
                morningEvents: typeof window.MORNING_EVENTS !== 'undefined',
                afternoonScheduleData: typeof window.AFTERNOON_SCHEDULE_DATA !== 'undefined',
                afternoonEvents: typeof window.AFTERNOON_EVENTS !== 'undefined',
                thursdayWidgetAPI: typeof window.NZGDCWidget !== 'undefined',
                morningWidgetAPI: typeof window.NZGDCMorningWidget !== 'undefined',
                afternoonWidgetAPI: typeof window.NZGDCAfternoonWidget !== 'undefined',
                thursdayWidgetReady: window.NZGDCWidget ? window.NZGDCWidget.isReady() : false,
                morningWidgetReady: window.NZGDCMorningWidget ? window.NZGDCMorningWidget.isReady() : false,
                afternoonWidgetReady: window.NZGDCAfternoonWidget ? window.NZGDCAfternoonWidget.isReady() : false
            };

            console.log('System Status:', systemStatus);

            // Thursday data integrity check
            if (window.SCHEDULE_DATA && window.WORKSHOP_EVENTS) {
                let totalWorkshops = 0;
                let workshopsWithData = 0;
                let missingWorkshops = [];

                console.log('\n=== THURSDAY WIDGET DATA VERIFICATION ===');
                window.SCHEDULE_DATA.timeSlots.forEach(timeSlot => {
                    console.log(`\n--- ${timeSlot.title} (${timeSlot.workshops.length} workshops) ---`);
                    timeSlot.workshops.forEach(workshop => {
                        totalWorkshops++;
                        const hasData = window.WORKSHOP_EVENTS[workshop.id];

                        if (hasData) {
                            workshopsWithData++;
                            console.log(`✅ ${workshop.id}: ${hasData.title}`);
                            console.log(`   Category: ${hasData.category} | Speakers: ${hasData.speakers?.length || 0}`);
                        } else {
                            missingWorkshops.push(workshop.id);
                            console.log(`❌ ${workshop.id}: NO DATA FOUND`);
                        }
                    });
                });

                console.log(`\n📊 Thursday Summary: ${workshopsWithData}/${totalWorkshops} workshops have data`);
                if (missingWorkshops.length > 0) {
                    console.error('Missing Thursday workshop data for:', missingWorkshops);
                }
            }

            // Morning data integrity check
            if (window.MORNING_SCHEDULE_DATA && window.MORNING_EVENTS) {
                let totalEvents = 0;
                let eventsWithData = 0;
                let missingEvents = [];

                console.log('\n=== MORNING WIDGET DATA VERIFICATION ===');
                window.MORNING_SCHEDULE_DATA.timeSlots.forEach(timeSlot => {
                    if (timeSlot.events) {
                        console.log(`\n--- ${timeSlot.title} (${timeSlot.events.length} events) ---`);
                        timeSlot.events.forEach(event => {
                            totalEvents++;
                            const hasData = window.MORNING_EVENTS[event.id];

                            if (hasData) {
                                eventsWithData++;
                                console.log(`✅ ${event.id}: ${hasData.title} (${event.type})`);
                                console.log(`   Category: ${hasData.category} | Speakers: ${hasData.speakers?.length || 0}`);
                            } else {
                                missingEvents.push(event.id);
                                console.log(`❌ ${event.id}: NO DATA FOUND (${event.type})`);
                            }
                        });
                    }
                });

                console.log(`\n📊 Morning Summary: ${eventsWithData}/${totalEvents} events have data`);
                if (missingEvents.length > 0) {
                    console.error('Missing Morning event data for:', missingEvents);
                }
            }

            // Afternoon data integrity check
            if (window.AFTERNOON_SCHEDULE_DATA && window.AFTERNOON_EVENTS) {
                let totalEvents = 0;
                let eventsWithData = 0;
                let missingEvents = [];

                console.log('\n=== AFTERNOON WIDGET DATA VERIFICATION ===');
                window.AFTERNOON_SCHEDULE_DATA.timeSlots.forEach(timeSlot => {
                    if (timeSlot.events) {
                        console.log(`\n--- ${timeSlot.title} (${timeSlot.events.length} events) ---`);
                        timeSlot.events.forEach(event => {
                            totalEvents++;
                            const hasData = window.AFTERNOON_EVENTS[event.id];

                            if (hasData) {
                                eventsWithData++;
                                console.log(`✅ ${event.id}: ${hasData.title} (${event.type})`);
                                console.log(`   Category: ${hasData.category} | Speakers: ${hasData.speakers?.length || 0}`);
                            } else {
                                missingEvents.push(event.id);
                                console.log(`❌ ${event.id}: NO DATA FOUND (${event.type})`);
                            }
                        });
                    }
                });

                console.log(`\n📊 Afternoon Summary: ${eventsWithData}/${totalEvents} events have data`);
                if (missingEvents.length > 0) {
                    console.error('Missing Afternoon event data for:', missingEvents);
                }
            }

            // DOM verification
            const thursdayContainers = document.querySelectorAll('.nzgdc-event-panel-container[data-event-id]');
            const thursdayWidgets = document.querySelectorAll('.nzgdc-schedule-widget');
            const morningContainers = document.querySelectorAll('.nzgdc-morning-event-panel-container[data-event-id], .nzgdc-morning-event-panel-main-container[data-event-id]');
            const morningWidgets = document.querySelectorAll('.nzgdc-morning-schedule-widget');
            const afternoonContainers = document.querySelectorAll('.nzgdc-afternoon-event-panel-container[data-event-id], .nzgdc-afternoon-event-panel-main-container[data-event-id]');
            const afternoonWidgets = document.querySelectorAll('.nzgdc-afternoon-schedule-widget');

            console.log(`\n🏗️ DOM Status:`);
            console.log(`- Thursday widget instances: ${thursdayWidgets.length}`);
            console.log(`- Thursday workshop containers: ${thursdayContainers.length}`);
            console.log(`- Morning widget instances: ${morningWidgets.length}`);
            console.log(`- Morning event containers: ${morningContainers.length}`);
            console.log(`- Afternoon widget instances: ${afternoonWidgets.length}`);
            console.log(`- Afternoon event containers: ${afternoonContainers.length}`);

            if (thursdayContainers.length > 0) {
                console.log('Thursday container IDs:', Array.from(thursdayContainers).map(c => c.dataset.eventId));
            }
            if (morningContainers.length > 0) {
                console.log('Morning container IDs:', Array.from(morningContainers).map(c => c.dataset.eventId));
            }
            if (afternoonContainers.length > 0) {
                console.log('Afternoon container IDs:', Array.from(afternoonContainers).map(c => c.dataset.eventId));
            }

            // Debug info if available
            if (window.NZGDCWidget && typeof window.NZGDCWidget.getDebugInfo === 'function') {
                console.log('\n🔧 Thursday Widget Debug Info:', window.NZGDCWidget.getDebugInfo());
            }
            if (window.NZGDCMorningWidget && typeof window.NZGDCMorningWidget.getDebugInfo === 'function') {
                console.log('\n🔧 Morning Widget Debug Info:', window.NZGDCMorningWidget.getDebugInfo());
            }
            if (window.NZGDCAfternoonWidget && typeof window.NZGDCAfternoonWidget.getDebugInfo === 'function') {
                console.log('\n🔧 Afternoon Widget Debug Info:', window.NZGDCAfternoonWidget.getDebugInfo());
            }

            updateStatus(`Data verification complete - check console for details`, 'success');
        }

        // Initialize button states
        updateButtonStates();
        updateBackgroundMessage();

        // Note: Auto-loading is DISABLED - widgets only load when manually requested
        // This ensures users see the background message and can choose which widgets to load

        // Debugging function for testing unified system
        function testUnifiedSystem() {
            console.log('🧪 Testing NZGDC Unified Widget System...\n');

            // Test UnifiedEventLoader availability
            console.log('1. UnifiedEventLoader availability:', typeof window.UnifiedEventLoader);

            if (window.UnifiedEventLoader) {
                try {
                    const loader = new UnifiedEventLoader();
                    console.log('2. UnifiedEventLoader instantiation: ✅ Success');

                    // Test template loading
                    loader.loadTemplate().then(() => {
                        console.log('3. Template loading: ✅ Success');
                        console.log('   Template loaded:', loader.template ? 'Yes' : 'No');

                        // Test event panel creation with sample data
                        const sampleEventData = {
                            category: 'Test Category',
                            title: 'Test Event Title',
                            timeframe: '30 minutes',
                            speakers: [
                                { name: 'Test Speaker', position: 'Test Position at Test Company' }
                            ]
                        };

                        try {
                            // Test big panel creation for each widget type
                            const thursdayPanel = loader.createEventPanel(sampleEventData, 'big', 'thursday');
                            const morningPanel = loader.createEventPanel(sampleEventData, 'big', 'morning');
                            const afternoonPanel = loader.createEventPanel(sampleEventData, 'big', 'afternoon');

                            console.log('4. Event panel creation:');
                            console.log('   Thursday big panel: ✅ Success');
                            console.log('   Morning big panel: ✅ Success');
                            console.log('   Afternoon big panel: ✅ Success');

                            // Test main panel creation
                            const mainPanel = loader.createEventPanel(sampleEventData, 'main', 'morning');
                            console.log('   Main panel: ✅ Success');

                        } catch (panelError) {
                            console.error('4. Event panel creation: ❌ Failed', panelError);
                        }

                    }).catch(templateError => {
                        console.error('3. Template loading: ❌ Failed', templateError);
                    });

                } catch (loaderError) {
                    console.error('2. UnifiedEventLoader instantiation: ❌ Failed', loaderError);
                }
            } else {
                console.error('1. UnifiedEventLoader not found - check if scripts loaded correctly');
            }

            // Test widget APIs
            console.log('\n5. Widget API availability:');
            console.log('   NZGDCWidget (Thursday):', typeof window.NZGDCWidget);
            console.log('   NZGDCMorningWidget:', typeof window.NZGDCMorningWidget);
            console.log('   NZGDCAfternoonWidget:', typeof window.NZGDCAfternoonWidget);

            // Test data availability
            console.log('\n6. Data availability:');
            console.log('   WORKSHOP_EVENTS:', typeof window.WORKSHOP_EVENTS);
            console.log('   MORNING_EVENTS:', typeof window.MORNING_EVENTS);
            console.log('   AFTERNOON_EVENTS:', typeof window.AFTERNOON_EVENTS);
            console.log('   SCHEDULE_DATA:', typeof window.SCHEDULE_DATA);
            console.log('   MORNING_SCHEDULE_DATA:', typeof window.MORNING_SCHEDULE_DATA);
            console.log('   AFTERNOON_SCHEDULE_DATA:', typeof window.AFTERNOON_SCHEDULE_DATA);

            // Test template availability
            console.log('\n7. Template availability:');
            console.log('   UNIFIED_EVENT_PANEL_TEMPLATE:', typeof window.UNIFIED_EVENT_PANEL_TEMPLATE);

            console.log('\n🧪 Unified system test complete - check results above');
        }

        // Make function available globally for console testing
        window.testUnifiedSystem = testUnifiedSystem;

        /**
         * Test Main Event Panel CSS availability and fix verification
         * Verifies that the CSS fix for missing main panel styles is working
         */
        function testMainEventPanelCSS() {
            console.log('\n🔧 === Main Event Panel CSS Verification Test ===');

            // Test CSS rule availability for both widget types
            const testResults = {
                morning: {},
                afternoon: {}
            };

            // Check if critical main panel CSS classes are available
            const criticalClasses = [
                '.nzgdc-event-panel-main',
                '.nzgdc-event-category-main',
                '.nzgdc-category-text-main',
                '.nzgdc-event-panel-title-main',
                '.nzgdc-title-text-main',
                '.nzgdc-event-panel-thumbnail-main',
                '.nzgdc-session-thumbnail-main',
                '.nzgdc-event-panel-overlay-main',
                '.nzgdc-speaker-details-main',
                '.nzgdc-speaker-name-main',
                '.nzgdc-speaker-position-company-main',
                '.nzgdc-call-to-action-main',
                '.nzgdc-open-marker-main',
                '.nzgdc-cta-text-main'
            ];

            // Create test elements to verify CSS is applied
            console.log('\n1. Testing Morning Widget CSS:');
            const morningTestContainer = document.createElement('div');
            morningTestContainer.className = 'nzgdc-morning-schedule-widget';
            morningTestContainer.style.position = 'absolute';
            morningTestContainer.style.left = '-9999px';
            morningTestContainer.style.top = '-9999px';

            const morningTestPanel = document.createElement('div');
            morningTestPanel.className = 'nzgdc-event-panel-main';
            morningTestContainer.appendChild(morningTestPanel);
            document.body.appendChild(morningTestContainer);

            // Test computed styles
            const morningStyles = window.getComputedStyle(morningTestPanel);
            testResults.morning.width = morningStyles.width;
            testResults.morning.height = morningStyles.height;
            testResults.morning.display = morningStyles.display;

            console.log('   Morning main panel width:', testResults.morning.width);
            console.log('   Morning main panel height:', testResults.morning.height);
            console.log('   Morning main panel display:', testResults.morning.display);

            // Test afternoon widget
            console.log('\n2. Testing Afternoon Widget CSS:');
            const afternoonTestContainer = document.createElement('div');
            afternoonTestContainer.className = 'nzgdc-afternoon-schedule-widget';
            afternoonTestContainer.style.position = 'absolute';
            afternoonTestContainer.style.left = '-9999px';
            afternoonTestContainer.style.top = '-9999px';

            const afternoonTestPanel = document.createElement('div');
            afternoonTestPanel.className = 'nzgdc-event-panel-main';
            afternoonTestContainer.appendChild(afternoonTestPanel);
            document.body.appendChild(afternoonTestContainer);

            const afternoonStyles = window.getComputedStyle(afternoonTestPanel);
            testResults.afternoon.width = afternoonStyles.width;
            testResults.afternoon.height = afternoonStyles.height;
            testResults.afternoon.display = afternoonStyles.display;

            console.log('   Afternoon main panel width:', testResults.afternoon.width);
            console.log('   Afternoon main panel height:', testResults.afternoon.height);
            console.log('   Afternoon main panel display:', testResults.afternoon.display);

            // Clean up test elements
            document.body.removeChild(morningTestContainer);
            document.body.removeChild(afternoonTestContainer);

            // Analyze results
            console.log('\n3. Test Results Analysis:');
            const morningValid = testResults.morning.width === '300px' &&
                                 testResults.morning.height === '300px' &&
                                 testResults.morning.display === 'flex';
            const afternoonValid = testResults.afternoon.width === '300px' &&
                                   testResults.afternoon.height === '300px' &&
                                   testResults.afternoon.display === 'flex';

            console.log('   Morning widget CSS fix status:', morningValid ? '✅ WORKING' : '❌ FAILED');
            console.log('   Afternoon widget CSS fix status:', afternoonValid ? '✅ WORKING' : '❌ FAILED');

            // Test CSS specificity
            console.log('\n4. CSS Specificity Test:');
            const stylesheets = Array.from(document.styleSheets);
            let foundMorningRules = 0;
            let foundAfternoonRules = 0;

            stylesheets.forEach((sheet, index) => {
                try {
                    const rules = Array.from(sheet.cssRules || []);
                    rules.forEach(rule => {
                        if (rule.selectorText) {
                            if (rule.selectorText.includes('.nzgdc-morning-schedule-widget .nzgdc-event-panel-main')) {
                                foundMorningRules++;
                            }
                            if (rule.selectorText.includes('.nzgdc-afternoon-schedule-widget .nzgdc-event-panel-main')) {
                                foundAfternoonRules++;
                            }
                        }
                    });
                } catch (e) {
                    // Skip stylesheets that can't be accessed (CORS)
                }
            });

            console.log('   Morning main panel CSS rules found:', foundMorningRules);
            console.log('   Afternoon main panel CSS rules found:', foundAfternoonRules);

            // Final assessment
            console.log('\n5. Final Assessment:');
            const overallSuccess = morningValid && afternoonValid && foundMorningRules > 0 && foundAfternoonRules > 0;

            if (overallSuccess) {
                console.log('   🎉 SUCCESS: Main Event Panel CSS fix is working correctly!');
                console.log('   ✅ Both Morning and Afternoon widgets have proper main panel styles');
                console.log('   ✅ CSS specificity conflicts have been resolved');
            } else {
                console.log('   ⚠️  WARNING: Main Event Panel CSS fix may have issues');
                if (!morningValid) console.log('   - Morning widget main panel styles not applied correctly');
                if (!afternoonValid) console.log('   - Afternoon widget main panel styles not applied correctly');
                if (foundMorningRules === 0) console.log('   - Morning main panel CSS rules not found');
                if (foundAfternoonRules === 0) console.log('   - Afternoon main panel CSS rules not found');
            }

            return {
                success: overallSuccess,
                morning: { valid: morningValid, rules: foundMorningRules },
                afternoon: { valid: afternoonValid, rules: foundAfternoonRules },
                results: testResults
            };
        }

        // Debug function to test Friday/Saturday widget system independently
        function debugFridaySaturdayWidget() {
            console.log('\n🔍 DEBUGGING FRIDAY/SATURDAY WIDGET SYSTEM');
            console.log('='.repeat(50));

            // Test 1: Check global function availability
            console.log('1. Global function availability:');
            console.log('   window.createFridaySaturdayWidget:', typeof window.createFridaySaturdayWidget);
            console.log('   window.NZGDCFridaySaturdayWidget:', typeof window.NZGDCFridaySaturdayWidget);
            console.log('   window.FridaySaturdayWidgetCore:', typeof window.FridaySaturdayWidgetCore);

            // Test 2: Check container element
            console.log('\n2. Container element check:');
            const container = document.getElementById('friday-saturday-container');
            console.log('   friday-saturday-container exists:', !!container);
            console.log('   container display style:', container ? container.style.display : 'N/A');

            // Test 3: Try direct class instantiation
            console.log('\n3. Direct class instantiation test:');
            try {
                if (window.FridaySaturdayWidgetCore) {
                    const testWidget = new window.FridaySaturdayWidgetCore('friday-saturday-container', {
                        enableDebug: true,
                        defaultView: 'morning'
                    });
                    console.log('   ✅ Direct instantiation SUCCESS');
                    console.log('   testWidget.containerId:', testWidget.containerId);
                    console.log('   testWidget.uniqueId:', testWidget.uniqueId);
                } else {
                    console.log('   ❌ FridaySaturdayWidgetCore not available');
                }
            } catch (error) {
                console.log('   ❌ Direct instantiation FAILED:', error.message);
            }

            // Test 4: Try global function call (dry run)
            console.log('\n4. Global function call test (dry run):');
            if (typeof window.createFridaySaturdayWidget === 'function') {
                console.log('   ✅ Global function exists and is callable');
                console.log('   Function length (parameter count):', window.createFridaySaturdayWidget.length);
            } else {
                console.log('   ❌ Global function not available');
            }

            console.log('\n🔍 Debug test complete');
        }

        /**
         * Test Expanded Event Details System
         * Verifies that the expanded event details overlay integration is working
         */
        function testExpandedEventDetails() {
            console.log('\n🔍 === EXPANDED EVENT DETAILS SYSTEM TEST ===');
            console.log('='.repeat(50));

            // Test 1: Check if manager class is available
            console.log('1. Manager availability:');
            console.log('   ExpandedEventDetailsManager:', typeof window.ExpandedEventDetailsManager);

            // Test 2: Check CSS loading
            console.log('\n2. CSS availability:');
            const expandedCSS = Array.from(document.styleSheets).some(sheet => {
                try {
                    return sheet.href && sheet.href.includes('expanded-event-details-overlay.css');
                } catch (e) {
                    return false;
                }
            });
            console.log('   Expanded details CSS loaded:', expandedCSS);

            // Test 3: Try to instantiate manager
            console.log('\n3. Manager instantiation test:');
            try {
                if (window.ExpandedEventDetailsManager) {
                    const testManager = new window.ExpandedEventDetailsManager();
                    console.log('   ✅ Manager instantiation SUCCESS');
                    console.log('   Manager status:', testManager.getStatus());

                    // Test 4: Template loading
                    console.log('\n4. Template loading test:');
                    testManager.loadTemplate().then(() => {
                        console.log('   ✅ Template loading SUCCESS');
                        console.log('   Template loaded:', testManager.templateLoaded);

                        // Test 5: Sample event data
                        console.log('\n5. Event data test:');
                        const sampleEventData = {
                            title: 'Test Event: Expanded Details Integration',
                            description: 'This is a test event to verify that the expanded event details overlay system is working correctly with the NZGDC widget integration.',
                            speakers: [
                                {
                                    name: 'Test Speaker One',
                                    position: 'Senior Developer @ Test Company',
                                    bio: 'Test speaker bio with extensive background in testing and development.',
                                    email: 'test1@example.com',
                                    website: 'testcompany.com'
                                },
                                {
                                    name: 'Test Speaker Two',
                                    position: 'Lead Designer @ Design Studio',
                                    bio: 'Another test speaker with design expertise.',
                                    email: 'test2@designstudio.com',
                                    website: 'designstudio.com'
                                }
                            ],
                            audienceTags: ['PROGRAMMING', 'EVERYONE'],
                            category: 'PROGRAMMING',
                            timeframe: '45 minutes'
                        };

                        try {
                            // Don't actually show the overlay in the test, just validate the data
                            const isValid = testManager.validateEventData(sampleEventData);
                            console.log('   Event data validation:', isValid ? '✅ VALID' : '❌ INVALID');

                            if (isValid) {
                                console.log('   Sample event title:', sampleEventData.title);
                                console.log('   Sample speakers count:', sampleEventData.speakers.length);
                                console.log('   Sample audience tags:', sampleEventData.audienceTags);
                            }

                            // Clean up test manager
                            testManager.destroy();
                            console.log('\n6. Manager cleanup: ✅ SUCCESS');

                        } catch (dataError) {
                            console.error('   ❌ Event data test FAILED:', dataError);
                        }

                    }).catch(templateError => {
                        console.error('   ❌ Template loading FAILED:', templateError);
                    });

                } else {
                    console.log('   ❌ ExpandedEventDetailsManager not available');
                }
            } catch (error) {
                console.error('   ❌ Manager instantiation FAILED:', error);
            }

            // Test 6: Integration with unified event loader
            console.log('\n7. Integration check:');
            console.log('   UnifiedEventLoader available:', typeof window.UnifiedEventLoader);

            // Check if click handlers have been modified
            if (window.UnifiedEventLoader) {
                console.log('   ✅ UnifiedEventLoader integration ready');
                console.log('   Note: Click any event panel overlay to test expanded details');
            } else {
                console.log('   ⚠️  UnifiedEventLoader not loaded yet');
            }

            console.log('\n🧪 Expanded Event Details test complete - check results above');
        }

        // Make testing functions available globally
        window.testMainEventPanelCSS = testMainEventPanelCSS;
        window.debugFridaySaturdayWidget = debugFridaySaturdayWidget;
        window.testExpandedEventDetails = testExpandedEventDetails;
    </script>

    <!-- Load widget scripts -->
    <script src="../nzgdc-schedule-widget-modular.js"></script>
    <script src="../nzgdc-friday-saturday-schedule-widget-modular.js"></script>
</body>
</html>
